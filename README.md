# HeliosX: Take home task

## How to run locally
This project can be built with the maven command (tests will run also):

```bash
  mvn clean install
```
To run the application:

```BASH
  mvn spring-boot:start
```

OAS3 documentation link - http://localhost:8080/v3/api-docs.

http://localhost:8080/swagger is the autogenerated Swagger page, where you could exercise the API and see documentation in more readable way.

To fire a request please do the following: 
* open the correspondent tab
* press button **Try it out**
* enter your parameters or use the default ones
* press button **Execute**

### Test scenarios
#### /consultation/questions
1. Happy path to get the questions (200 OK) - use the default value provided
2. Condition not found (404 Not Found) - enter any other value

#### /consultation/customers/{customer-id}/conditions/{condition-id}/answers
1. Happy path with possible prescription (200 OK) - use the following request body
```json
[
  {
    "questionId": "allergy-genovian-pear-q1",
    "answerIds": [
      "allergy-genovian-pear-q1-a1"
    ]
  },
  {
    "questionId": "allergy-genovian-pear-q2",
    "answerIds": [
      "allergy-genovian-pear-q2-a1",
      "allergy-genovian-pear-q2-a3"
    ]
  },
  {
    "questionId": "allergy-genovian-pear-q3",
    "freeFormAnswer": "I'm allergic to starch also"
  }
]
```

2. Happy path with not possible prescription (200 OK) - use the following request body
```json
[
  {
    "questionId": "allergy-genovian-pear-q1",
    "answerIds": [
      "allergy-genovian-pear-q1-a2"
    ]
  },
  {
    "questionId": "allergy-genovian-pear-q2",
    "answerIds": [
      "allergy-genovian-pear-q2-a1",
      "allergy-genovian-pear-q2-a3"
    ]
  },
  {
    "questionId": "allergy-genovian-pear-q3",
    "freeFormAnswer": "I'm allergic to starch also"
  }
]
```

3. Condition not found (404 Not Found) - enter any other value for condition-id variable
4. Question not found (404 Not Found) - use the following request body
```json
[
  {
    "questionId": "XXX",
    "answerIds": [
      "allergy-genovian-pear-q2-a1",
      "allergy-genovian-pear-q2-a3"
    ]
  }
]
```

5. Not valid answers format (400 Bad Request) - use empty request body
```json
[
  
]
```

## Notes
Just a couple of tests were added, with comments about what else should be tested. Some files are missing tests completely as time was limited.

I suppose that there is a separate module that signs in a user, verify their email, creates account, and issues some kind of auth token with user id inside (for example, JWT).

Authorisation is missing on `submitAnswers`, with the ability to check that consumer id in the request is matching authorised user. 
Auth is a must here to avoid possible attack with overloading DB with information.

User input for free-form question should be sanitized before saving to prevent injection attacks.

Application was intended to have domain-driven design, but domain services layer was omitted for simplification. 
`AnswerRepository` and `QuestionRepository` are supposed to work with DB. 
In-memory data in `QuestionRepository` were designed with future DB table design in mind.

Ids format was chosen for its readability. All answer ids are unique across all the questions, all questions ids are unique across all the conditions.

Ordering is important in questions and in answers - that's why answer's type is List and not Set.

I used NHS site to copy allergy symptoms :-)

### Possible extensions
* Return questions as pageable
* Adding question language
* Adding new type of answer: checkbox with free-form text
* In `submitAnswers` return number of questions left to answer to show progress bar